<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¸ å°ˆæ¥­ç´šå‰ä»–å’Œå¼¦åº«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --success: #27ae60; --bg: #f8f9fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .controls { margin-bottom: 25px; text-align: center; }
        #soundToggle { padding: 12px 24px; font-size: 1rem; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; transition: 0.3s; background-color: #ddd; color: #333; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #soundToggle.active { background-color: var(--success); color: white; }
        .main-container { display: flex; gap: 30px; max-width: 1100px; width: 100%; flex-wrap: wrap; justify-content: center; }
        .chord-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); flex: 1; min-width: 320px; min-height: 300px; }
        .chord-btn { padding: 12px 5px; border: 1px solid #eee; background: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 0.9rem; }
        .chord-btn:hover { background: #f9f9f9; border-color: var(--accent); }
        .chord-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        .display-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 320px; position: sticky; top: 20px; height: fit-content; }
        .status-bar { display: flex; justify-content: space-between; width: 200px; margin: 0 auto 5px auto; font-weight: bold; font-size: 1.4rem; height: 30px; }
        .status-item { width: 20px; text-align: center; line-height: 30px; }
        .status-x { color: #e74c3c; }
        .status-o { color: var(--success); }
        .fretboard { width: 200px; height: 240px; margin: 0 auto; position: relative; border: 2px solid #444; background: #fff; }
        .string { position: absolute; width: 2px; background: #bbb; height: 100%; }
        .fret { position: absolute; height: 2px; background: #444; width: 100%; }
        .s1{left:100%} .s2{left:80%} .s3{left:60%} .s4{left:40%} .s5{left:20%} .s6{left:0%}
        .f1{top:20%} .f2{top:40%} .f3{top:60%} .f4{top:80%}
        .finger { position: absolute; width: 24px; height: 24px; background: #e74c3c; border-radius: 50%; transform: translate(-50%, -50%); z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #loadingMsg { font-size: 0.8rem; color: #999; margin-top: 8px; font-weight: normal; }
        @media (max-width: 768px) { .chord-grid { grid-template-columns: repeat(4, 1fr); } .main-container { flex-direction: column-reverse; } }
    </style>
</head>
<body>

    <h1>ğŸ¸ å°ˆæ¥­ç´šå‰ä»–å’Œå¼¦åº«</h1>
    
    <div class="controls">
        <button id="soundToggle" onclick="toggleSound()">ğŸ”‡ è²éŸ³ï¼šå·²é—œé–‰</button>
        <p id="loadingMsg">æ­£åœ¨å•Ÿå‹•éŸ³æ•ˆå¼•æ“...</p>
    </div>

    <div class="main-container">
        <div class="chord-grid" id="chordGrid"></div>

        <div class="display-card">
            <div class="status-bar" id="statusBar">
                <div class="status-item"></div><div class="status-item"></div><div class="status-item"></div>
                <div class="status-item"></div><div class="status-item"></div><div class="status-item"></div>
            </div>
            <div class="fretboard" id="fretboard">
                <div class="string s1"></div><div class="string s2"></div><div class="string s3"></div>
                <div class="string s4"></div><div class="string s5"></div><div class="string s6"></div>
                <div class="fret f1"></div><div class="fret f2"></div><div class="fret f3"></div><div class="fret f4"></div>
            </div>
            <h2 id="currentName" style="color: var(--accent); margin-top: 15px; margin-bottom: 5px;">è«‹é¸æ“‡å’Œå¼¦</h2>
            <p style="font-size: 0.9rem; color: #666; margin: 0;">çµ„æˆéŸ³ï¼š<span id="chordNotes">-</span></p>
        </div>
    </div>

    <script>
        // 1. å’Œå¼¦è³‡æ–™å®šç¾©
        const chords = {
            "C": { fingers: [{s:5, f:3}, {s:4, f:2}, {s:2, f:1}], status: ["x","o","o","o","o","o"], notes: "C, E, G", freq: ["C3", "E3", "G3", "C4", "E4"] },
            "G": { fingers: [{s:6, f:3}, {s:5, f:2}, {s:1, f:3}], status: ["o","o","o","o","o","o"], notes: "G, B, D", freq: ["G2", "B2", "D3", "G3", "B3", "G4"] },
            "D": { fingers: [{s:3, f:2}, {s:2, f:3}, {s:1, f:2}], status: ["x","x","o","o","o","o"], notes: "D, F#, A", freq: ["D3", "A3", "D4", "F#4"] },
            "A": { fingers: [{s:4, f:2}, {s:3, f:2}, {s:2, f:2}], status: ["x","o","o","o","o","o"], notes: "A, C#, E", freq: ["A2", "E3", "A3", "C#4", "E4"] },
            "E": { fingers: [{s:5, f:2}, {s:4, f:2}, {s:3, f:1}], status: ["o","o","o","o","o","o"], notes: "E, G#, B", freq: ["E2", "B2", "E3", "G#3", "B3", "E4"] },
            "Am": { fingers: [{s:4, f:2}, {s:3, f:2}, {s:2, f:1}], status: ["x","o","o","o","o","o"], notes: "A, C, E", freq: ["A2", "E3", "A3", "C4", "E4"] },
            "Em": { fingers: [{s:5, f:2}, {s:4, f:2}], status: ["o","o","o","o","o","o"], notes: "E, G, B", freq: ["E2", "B2", "E3", "G3", "B3", "E4"] },
            "Dm": { fingers: [{s:3, f:2}, {s:2, f:3}, {s:1, f:1}], status: ["x","x","o","o","o","o"], notes: "D, F, A", freq: ["D3", "A3", "D4", "F4"] },
            "F": { fingers: [{s:6, f:1}, {s:5, f:3}, {s:4, f:3}, {s:3, f:2}, {s:2, f:1}, {s:1, f:1}], status: ["o","o","o","o","o","o"], notes: "F, A, C", freq: ["F2", "C3", "F3", "A3", "C4", "F4"] },
            "Bm": { fingers: [{s:5, f:2}, {s:4, f:4}, {s:3, f:4}, {s:2, f:3}, {s:1, f:2}], status: ["x","o","o","o","o","o"], notes: "B, D, F#", freq: ["B2", "F#3", "B3", "D4", "F#4"] },
            "C7": { fingers: [{s:5, f:3}, {s:4, f:2}, {s:3, f:3}, {s:2, f:1}], status: ["x","o","o","o","o","o"], notes: "C, E, G, Bb", freq: ["C3", "E3", "Bb3", "C4", "E4"] },
            "G7": { fingers: [{s:6, f:3}, {s:5, f:2}, {s:1, f:1}], status: ["o","o","o","o","o","o"], notes: "G, B, D, F", freq: ["G2", "B2", "D3", "G3", "B3", "F4"] },
            "D7": { fingers: [{s:3, f:2}, {s:2, f:1}, {s:1, f:2}], status: ["x","x","o","o","o","o"], notes: "D, F#, A, C", freq: ["D3", "A3", "C4", "F#4"] },
            "A7": { fingers: [{s:4, f:2}, {s:2, f:2}], status: ["x","o","o","o","o","o"], notes: "A, C#, E, G", freq: ["A2", "E3", "G3", "C#4", "E4"] },
            "E7": { fingers: [{s:5, f:2}, {s:3, f:1}], status: ["o","o","o","o","o","o"], notes: "E, G#, B, D", freq: ["E2", "B2", "D3", "G#3", "B3", "E4"] },
            "Fmaj7": { fingers: [{s:4, f:3}, {s:3, f:2}, {s:2, f:1}], status: ["x","x","o","o","o","o"], notes: "F, A, C, E", freq: ["F3", "A3", "C4", "E4"] },
            "Cadd9": { fingers: [{s:5, f:3}, {s:4, f:2}, {s:2, f:3}], status: ["x","o","o","o","o","o"], notes: "C, E, G, D", freq: ["C3", "E3", "G3", "D4"] },
            "Asus4": { fingers: [{s:4, f:2}, {s:3, f:2}, {s:2, f:3}], status: ["x","o","o","o","o","o"], notes: "A, D, E", freq: ["A2", "E3", "A3", "D4", "E4"] },
            "Dsus4": { fingers: [{s:3, f:2}, {s:2, f:3}, {s:1, f:3}], status: ["x","x","o","o","o","o"], notes: "D, G, A", freq: ["D3", "A3", "D4", "G4"] },
            "B7": { fingers: [{s:5, f:2}, {s:4, f:1}, {s:3, f:2}, {s:1, f:2}], status: ["x","o","o","o","o","o"], notes: "B, D#, F#, A", freq: ["B2", "D#3", "A3", "B3", "F#4"] },
            "Am7": { fingers: [{s:4, f:2}, {s:2, f:1}], status: ["x","o","o","o","o","o"], notes: "A, C, E, G", freq: ["A2", "E3", "G3", "C4", "E4"] },
            "Em7": { fingers: [{s:5, f:2}, {s:4, f:2}, {s:2, f:3}], status: ["o","o","o","o","o","o"], notes: "E, G, B, D", freq: ["E2", "B2", "D3", "G3", "D4", "E4"] },
            "Dm7": { fingers: [{s:3, f:2}, {s:2, f:1}, {s:1, f:1}], status: ["x","x","o","o","o","o"], notes: "D, F, A, C", freq: ["D3", "A3", "C4", "F4"] },
            "Gmaj7": { fingers: [{s:6, f:3}, {s:1, f:2}], status: ["o","o","o","o","o","o"], notes: "G, B, D, F#", freq: ["G2", "B2", "D3", "G3", "B3", "F#4"] },
            "Bb": { fingers: [{s:5, f:1}, {s:4, f:3}, {s:3, f:3}, {s:2, f:3}], status: ["x","o","o","o","o","o"], notes: "Bb, D, F", freq: ["Bb2", "F3", "Bb3", "D4", "F4"] },
            "Gm": { fingers: [{s:6, f:3}, {s:5, f:5}, {s:4, f:5}, {s:3, f:3}, {s:2, f:3}, {s:1, f:3}], status: ["o","o","o","o","o","o"], notes: "G, Bb, D", freq: ["G2", "D3", "G3", "Bb3", "D4", "G4"] },
            "F#m": { fingers: [{s:6, f:2}, {s:5, f:4}, {s:4, f:4}, {s:3, f:2}, {s:2, f:2}, {s:1, f:2}], status: ["o","o","o","o","o","o"], notes: "F#, A, C#", freq: ["F#2", "C#3", "F#3", "A3", "C#4", "F#4"] },
            "Bm7": { fingers: [{s:5, f:2}, {s:3, f:2}, {s:2, f:3}], status: ["x","o","o","o","o","o"], notes: "B, D, F#, A", freq: ["B2", "F#3", "A3", "D4", "F#4"] },
            "Emaj7": { fingers: [{s:5, f:2}, {s:4, f:1}, {s:3, f:1}], status: ["o","o","o","o","o","o"], notes: "E, G#, B, D#", freq: ["E2", "B2", "D#3", "G#3", "B3", "E4"] },
            "G6": { fingers: [{s:6, f:3}, {s:5, f:2}], status: ["o","o","o","o","o","o"], notes: "G, B, D, E", freq: ["G2", "B2", "D3", "G3", "B3", "E4"] }
        };

        // 2. ç«‹å³ç”Ÿæˆ UI æŒ‰éˆ• (é€™æ®µç¨‹å¼ç¢¼è¦æœ€å…ˆåŸ·è¡Œ)
        function initButtons() {
            const grid = document.getElementById('chordGrid');
            if (!grid) return;
            Object.keys(chords).forEach(name => {
                const btn = document.createElement('button');
                btn.className = 'chord-btn';
                btn.innerText = name;
                btn.onclick = () => selectChord(name, btn);
                grid.appendChild(btn);
            });
            console.log("æŒ‰éˆ•ç”Ÿæˆå®Œç•¢");
        }
        initButtons();

        // 3. ç•°æ­¥è¼‰å…¥éŸ³è‰²å¼•æ“
        let isSoundOn = false;
        let useGuitar = false;
        const fallbackSynth = new Tone.PolySynth(Tone.Synth).toDestination();

        // å˜—è©¦å¾ CDN è¼‰å…¥çœŸå¯¦éŸ³è‰²
        const sampler = new Tone.Sampler({
            urls: { "A2": "A2.mp3", "C3": "C3.mp3", "E3": "E3.mp3", "G3": "G3.mp3", "A3": "A3.mp3", "C4": "C4.mp3" },
            baseUrl: "https://gleitz.github.io/midi-js-soundfonts/MusyngKite/acoustic_guitar_nylon-mp3/",
            onload: () => {
                useGuitar = true;
                document.getElementById('loadingMsg').innerText = "âœ… çœŸå¯¦æœ¨å‰ä»–éŸ³è‰²è¼‰å…¥å®Œæˆ";
            },
            onerror: () => {
                document.getElementById('loadingMsg').innerText = "âš ï¸ å¤–éƒ¨éŸ³æºè¼‰å…¥æ…¢ï¼Œæš«ç”¨åˆæˆéŸ³ä»£æ›¿";
            }
        }).toDestination();

        // å¦‚æœ 3 ç§’å…§æ²’è¼‰å…¥å®Œï¼Œå¼·åˆ¶æ›´æ–°æ–‡å­—é¿å…ä½¿ç”¨è€…ä¹¾ç­‰
        setTimeout(() => {
            if (!useGuitar) document.getElementById('loadingMsg').innerText = "âš ï¸ æ­£åœ¨èƒŒæ™¯åŠªåŠ›è¼‰å…¥éŸ³è‰²ä¸­...";
        }, 3000);

        function toggleSound() {
            isSoundOn = !isSoundOn;
            const btn = document.getElementById('soundToggle');
            if (isSoundOn) {
                btn.innerText = "ğŸ”Š è²éŸ³ï¼šå·²é–‹å•Ÿ";
                btn.classList.add('active');
                Tone.start();
            } else {
                btn.innerText = "ğŸ”‡ è²éŸ³ï¼šå·²é—œé–‰";
                btn.classList.remove('active');
            }
        }

        function selectChord(name, btnElement) {
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.chord-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');

            const chord = chords[name];
            document.getElementById('currentName').innerText = name;
            document.getElementById('chordNotes').innerText = chord.notes;

            // æ›´æ–° O/X æ¨™ç¤º
            const statusItems = document.querySelectorAll('.status-item');
            chord.status.forEach((s, i) => {
                if (s === 'x') {
                    statusItems[i].innerHTML = '<span class="status-x">âœ•</span>';
                } else {
                    statusItems[i].innerHTML = '<span class="status-o">â—‹</span>';
                }
            });

            // æ›´æ–°æŒ‡æ¿åœ–å½¢
            const board = document.getElementById('fretboard');
            document.querySelectorAll('.finger').forEach(f => f.remove());
            chord.fingers.forEach(f => {
                const dot = document.createElement('div');
                dot.className = 'finger';
                dot.style.left = (6 - f.s) * 20 + '%';
                dot.style.top = (f.f * 20) - 10 + '%';
                board.appendChild(dot);
            });

            // æ’­æ”¾è²éŸ³ (Strum æ’¥å¼¦æ•ˆæœ)
            if (isSoundOn) {
                const now = Tone.now();
                const player = useGuitar ? sampler : fallbackSynth;
                chord.freq.forEach((f, i) => {
                    player.triggerAttackRelease(f, "2n", now + i * 0.05);
                });
            }
        }
    </script>
</body>
</html>
